<?xml version="1.0" ?><data>
	<environment>
		<morninggreeting/>
		<latereminder>true</latereminder>
		<night>true</night>
		<location/>
		<energy/>
		<weather/>
		<messages><message>'this is Igor. The time is now' 23'.'30</message></messages>
		<devices/>
		<lights/>
		<systemHealth>
			<messages/>
		</systemHealth>
		<introspection>
			<lastActivity><igor>2017-08-21T23:30:00.670751</igor><reboot>2017-08-21T23:30:00</reboot></lastActivity>
			<rebootCount>1.0</rebootCount>
		</introspection>
	</environment>
	<sensors>
		<ble/>
	</sensors>
	<sensors/>
	<devices>
	</devices>
	<services>
		<igor><url>http://igor.local:9333/data</url><host>igor.local</host><version>0.4</version><port>9333</port><startTime>1503351000</startTime></igor>
	</services>
	<people/>
	<identities/>
	<actions>
		<action>
			<name>updateMessage</name>
			<interval>500</interval>
			<url>/data/environment/messages/message</url>
			<method>POST</method>
			<mimetype>text/plain</mimetype>
			<data>'this is Igor. The time is now' {igor_hours_from_dateTime(igor_dateTime())}'.'{igor_minutes_from_dateTime(igor_dateTime())}</data>
		<notBefore>1503351000</notBefore></action>
		<action>
			<name>checkLate_reminder</name>
			<interval>500</interval>
			<condition>/data/environment[latereminder='true']</condition>
		    <url>/data/environment/messages/message</url>
			<method>POST</method>
			<mimetype>text/plain</mimetype>
			<data>'Its late, you should be sleeping!'</data>
			<multiple>True</multiple>
		</action>
		<action>
			<name>checkMorning_reminder</name>
			<interval>500</interval>
			<condition>/data/environment[morninggreeting='true']</condition>
		    <url>/data/environment/messages/message</url>
			<method>POST</method>
			<mimetype>text/plain</mimetype>
			<data>'Good morning, you are early!'</data>
			<multiple>True</multiple>
		</action>
		<action>
            <xpath>/data/sensors/ble/bleDevice</xpath>
            <condition>/data/plugindata/bleDevices/bleDevice[id=string($originalContext/address)]/name</condition>
            <url>/data/environment/messages/message</url>
            <method>PUT</method>
            <mimetype>text/plain</mimetype>
            <data>'Igor has found'{/data/plugindata/bleDevices/bleDevice[id=string($originalContext/address)]/name}</data>
            <multiple>True</multiple>
        </action>
	    <action>
			<xpath>/data/environment/messages/*</xpath>
			<condition>not(data/environment/night)</condition>
			<url>/pluginscripts/say/message?args={.}</url>
		<notBefore>1503351000</notBefore></action>
	    <action>
            <interval>60</interval>
            <url>/pluginscripts/ble/pull</url>
            <aggregate>true</aggregate>
        <notBefore>1503351000</notBefore></action>
		<action>
            <xpath>/data/sensors/ble/bleDevice</xpath>
            <condition>/data/plugindata/bleDevices/bleDevice[id=string($originalContext/address)]/name</condition>
            <url>/data/environment/devices/{/data/plugindata/bleDevices/bleDevice[id=string($originalContext/address)]/name}</url>
            <method>PUT</method>
            <mimetype>text/plain</mimetype>
            <data>{available}</data>
            <multiple>True</multiple>
        </action>
        <action>
            <xpath>/data/sensors/ble/bleDevice</xpath>
            <url>/data/environment/introspection/lastActivity/ble</url>
            <method>PUT</method>
            <mimetype>text/plain</mimetype>
            <data>{igor_dateTime()}</data>
        </action>
	    <action>
	        <name>start</name>
	        <url>/internal/started</url>
	    <notBefore>1503351006</notBefore></action>
		<action>
			<name>rebooted</name>
            <xpath>/data/services/igor/startTime</xpath>
            <url>/data/environment/introspection/lastActivity/reboot</url>
            <method>PUT</method>
            <mimetype>text/plain</mimetype>
            <data>{igor_dateTime(.)}</data>
		<notBefore>1503351000</notBefore></action>
		<action>
			<name>rebooted</name>
            <xpath>/data/services/igor/startTime</xpath>
            <url>/data/environment/introspection/rebootCount</url>
            <method>PUT</method>
            <mimetype>text/plain</mimetype>
            <data>{number(/data/environment/introspection/rebootCount)+1}</data>
		<notBefore>1503351000</notBefore></action>
		<action>
			<name>save</name>
			<interval>3600</interval>
			<minInterval>60</minInterval>
			<url>/internal/save</url>
			<xpath>/data/plugindata//* | /data/actions/* | /data/triggers/* | /data/identities//* | /data/sandbox/*</xpath>
		<notBefore>1503351060</notBefore></action>
        <action>
            <name>cleanup</name>
            <method>DELETE</method>
            <url>/data/environment/messages/message[position()&lt;last()]</url>
        </action>
		<action>
			<name>updateActions</name>
			<xpath>/data/actions/*</xpath>
			<url>/internal/updateActions</url>
		</action>
		<action>
            <name>checkNight</name>
            <interval>900</interval>
            <method>PUT</method>
            <url>/data/environment/night</url>
            <mimetype>text/plain</mimetype>
            <data>{igor_hours_from_dateTime(igor_dateTime()) &lt; 8 or igor_hours_from_dateTime(igor_dateTime()) &gt;= 23}</data>
		<notBefore>1503351000</notBefore></action>
		<action>
            <name>checkLate</name>
            <interval>900</interval>
            <method>PUT</method>
            <url>/data/environment/latereminder</url>
            <mimetype>text/plain</mimetype>
            <data>{igor_hours_from_dateTime(igor_dateTime()) &lt; 2 or igor_hours_from_dateTime(igor_dateTime()) &gt;= 23}</data>
		<notBefore>1503351000</notBefore></action>
		<action>
            <name>checkMorning</name>
            <interval>900</interval>
            <method>PUT</method>
            <url>/data/environment/morninggreeting/</url>
            <mimetype>text/plain</mimetype>
            <data>{igor_hours_from_dateTime(igor_dateTime()) &lt; 9 or igor_hours_from_dateTime(igor_dateTime()) &gt;= 6}</data>
		<notBefore>1503351000</notBefore></action>
		<action>
			<name>updatePeople</name>
			<xpath>/data/environment/devices/*</xpath>
			<condition>/data/identities/*[device=name($originalContext)]</condition>
			<url>
			/data/people/{name(/data/identities/*[device=name($originalContext)])}/home
			</url>
			<method>PUT</method>
			<mimetype>text/plain</mimetype>
			<data>{.}</data>
			<multiple>true</multiple>
		</action>
		<action>
			<name>updateIgor</name>
			<interval>60</interval>
			<url>/data/environment/introspection/lastActivity/igor</url>
			<method>PUT</method>
			<mimetype>text/plain</mimetype>
			<data>{igor_dateTime()}</data>
		<notBefore>1503351000</notBefore></action>
	</actions>
	<sandbox/>
	<eventsources/>
	<plugindata>
	    <bleDevices>
			<bleDevice>
				<id>a4:77:33:c0:5d:8f</id>
				<name>My_google_hardware</name>
			</bleDevice>
			<bleDevice>
				<id>0b:f7:01:e5:10:a7</id>
				<name>My_microsoft_hardware</name>
			</bleDevice>
		</bleDevices>
	</plugindata>
	
</data>